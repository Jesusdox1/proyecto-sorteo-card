<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo de Chocolate</title>
    <link rel="stylesheet" href="style.css"> <!-- Archivo CSS para el diseño -->
</head>
<body>
    
    <header>
        <h1>Sorteo</h1>
        <p>Participa en el sorteo de tarjetas de regalo</p>
    </header>

    <!-- Registro -->
    <section>
        <h2>Registro para Participar</h2>
        <p>Para participar, ingresa tu número de teléfono. Para después pasar a un pequeño formulario.</p>

        <!-- Formulario de Registro -->
        <form id="form-registro">
            <div>
                <label for="telefono">Número de Teléfono:</label>
                <input type="tel" id="telefono" name="telefono" pattern="[0-9]{10}" required placeholder="Ej. 9981567890">
                <span id="telefono-error" style="color: red;"></span>
            </div>
            <div>
                <button type="submit">Enviar</button>
            </div>
        </form>
    </section>

    <!-- Información del sorteo -->
    <section>
        <h2>Detalles del Sorteo</h2>
        <p>El sorteo se llevará a cabo el <strong>"		"</strong>. Los ganadores serán contactados por teléfono y sus nombres aparecerán en esta página.</p>
    </section>

    <!-- Sección de Ganadores -->
    <section id="ganadores">
        <h2>Ganadores del Sorteo</h2>
        <ul>
            <li>Aquí se mostrarán los ganadores después del sorteo.</li>
        </ul>
    </section>

    <!-- Footer -->
    <footer>    
        <p> 2024 Sorteo Tecnm Cancún.</p>
    </footer>

    <script>
        document.getElementById('form-registro').addEventListener('submit', async function(e) {
            e.preventDefault();  // Evita que se envíe el formulario por defecto
            const telefono = document.getElementById('telefono').value;
            const errorSpan = document.getElementById('telefono-error');

            // Validación del número de teléfono
            if (!telefono.match(/^\d{10}$/)) {
                errorSpan.textContent = 'El número de teléfono debe tener 10 dígitos';
                return;
            } else if (!/^[5-9]\d{9}$/.test(telefono)) {
                errorSpan.textContent = 'El número debe empezar con un dígito entre 5 y 9.';
                return;
            } else {
                errorSpan.textContent = '';
            }

            // Enviar los datos al backend usando fetch
            try {
                const response = await fetch('/api/registro', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ telefono }),
                });

                const data = await response.json();
                if (response.ok) {
                    alert('Número registrado exitosamente');
                } else {
                    errorSpan.textContent = data.message || 'Error al registrar el número';
                }
            } catch (error) {
                errorSpan.textContent = 'Error en la solicitud: ' + error.message;
            }
        });
    </script>
</body>
</html>

